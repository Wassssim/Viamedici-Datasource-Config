<div id="addRowModal" class="modal" [ngClass]="{ 'show d-block': showModal }">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ editMode ? "Edit Row" : "Add New Row" }}</h5>
        <button type="button" class="close" (click)="closeModal()">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="form" (ngSubmit)="saveItem()" *ngIf="form">
          <div *ngFor="let column of columns" class="form-group">
            <!-- Add a red star for required fields -->
            <label [for]="column.name">
              {{ column.name }}
              <span
                *ngIf="!column.default && !column.isNullable"
                class="text-danger"
                >*</span
              >
            </label>

            <app-foreign-key-select
              *ngIf="column.constraints.foreignKey"
              [sourceType]="sourceType"
              [sourceId]="sourceId"
              [column]="column"
              [isInvalid]="
                form.controls[column.name].invalid &&
                (form.controls[column.name].touched || submitted)
              "
              (valueChange)="form.controls[column.name].setValue($event)"
            ></app-foreign-key-select>

            <ng-container
              [ngSwitch]="column.type"
              *ngIf="!column.constraints.foreignKey"
            >
              <input
                *ngSwitchCase="'number'"
                type="number"
                class="form-control"
                [ngClass]="{
                  'is-invalid':
                    form.controls[column.name].invalid &&
                    (form.controls[column.name].touched || submitted)
                }"
                formControlName="{{ column.name }}"
              />
              <input
                *ngSwitchCase="'string'"
                type="text"
                class="form-control"
                [ngClass]="{
                  'is-invalid':
                    form.controls[column.name].invalid &&
                    (form.controls[column.name].touched || submitted)
                }"
                formControlName="{{ column.name }}"
              />
              <input
                *ngSwitchCase="'json'"
                type="text"
                class="form-control"
                [ngClass]="{
                  'is-invalid':
                    form.controls[column.name].invalid &&
                    (form.controls[column.name].touched || submitted)
                }"
                formControlName="{{ column.name }}"
              />
              <input
                *ngSwitchCase="'datetime'"
                type="datetime-local"
                class="form-control"
                [ngClass]="{
                  'is-invalid':
                    form.controls[column.name].invalid &&
                    (form.controls[column.name].touched || submitted)
                }"
                formControlName="{{ column.name }}"
              />
              <input
                *ngSwitchCase="'boolean'"
                type="checkbox"
                [ngClass]="{
                  'is-invalid':
                    form.controls[column.name].invalid &&
                    (form.controls[column.name].touched || submitted)
                }"
                formControlName="{{ column.name }}"
              />
              <input
                *ngSwitchDefault
                type="text"
                class="form-control"
                [ngClass]="{
                  'is-invalid':
                    form.controls[column.name].invalid &&
                    (form.controls[column.name].touched || submitted)
                }"
                formControlName="{{ column.name }}"
              />
            </ng-container>

            <div
              *ngIf="column.isAutoGenerated"
              class="error-text"
              style="color: gray"
            >
              {{ column.name }} is autogenerated
            </div>

            <!-- Error message for required fields -->
            <div
              *ngIf="
                form.controls[column.name].invalid &&
                (form.controls[column.name].touched || submitted)
              "
              class="error-text text-danger"
            >
              {{ column.name }} is required
            </div>
          </div>

          <div class="modal-action-buttons">
            <button type="submit" class="btn btn-primary">Save</button>
            <button
              type="button"
              class="btn btn-secondary"
              (click)="closeModal()"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
